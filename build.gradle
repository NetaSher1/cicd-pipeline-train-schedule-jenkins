plugins {
    id 'com.moowork.node' version '1.3.1'
}

repositories {
    mavenCentral()
}

node {
    version = '9.11.1'
    npmVersion = '5.6.0'
    download = true
}

// Declare a build task
task build

// Declare a task to create a zip of the app
task zip(type: Zip) {
    from ('.') {
        include "*"
        include "bin/**"
        include "data/**"
        include "node_modules/**"
        include "public/**"
        include "routes/**"
        include "views/**"
    }
    destinationDir(file("dist"))
    baseName "trainSchedule"
}

// Declare task dependencies
build.dependsOn(zip)
zip.dependsOn(npm_build)
npm_build.dependsOn(npm_test)

// Ensure npmInstall runs before npm_build and npm_test
npm_build.dependsOn(npmInstall)
npm_test.dependsOn(npmInstall)

// Add a resolution strategy to handle the layout method
configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details ->
        if (details.requested.group == 'com.moowork.gradle' &&
            details.requested.name == 'gradle-node-plugin') {
            details.useVersion('1.4.1')
        }
    }
}
